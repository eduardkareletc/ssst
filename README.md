# SSST

A simple static site tool to maintain websites based on markdown and pandoc

# Description

Given a set of posts or pages written in markdown, SSST generates the corresponding HTML files as well as any monthly archives, tag and category files. It also generates a home page summarising recent posts, and a main archive file linking to all existing monthly archives.

Depending in the actual structure of the source tree, SSST mimics the directory structure typically used in WordPress hosted sites. This allows one to use SSST to create a static replacement for a site that was previously managed using WordPress, ensuring that any external links that point to a page remain functional.

The conversion is driven by `pandoc`, using template files (that can be changed to customise website layout).

The resulting website is completely static: no PERL or PHP or whatever is required on the webserver. Also, no JavaScript is used. All you need to do is to push the generated HTML to the webserver. 

SSST does not unnecessarily touch generated output files, ensuring that when mirroring the generated HTML files to the webserver (through rsync or FTP mirroring options), only files whose content have actually changed have fresh timestamps and will be considered for upload.

Even though the website is static, SSST also allows users to comment on posts through mail when they click on automatically generated `mailto` links embedded in posts and comments. These links ensure that the path to the post or comment replied to is automatically included in the subject field. This allows you to quickly insert the comment at the right place after moderation.

SSST also processes LaTeX equations in a post, replacing them with SVG images containing the rendered equation in the output HTML. This uses `pdflatex` and `pdf2svg`. If an equation occurs on a single page more than once, only on image is generated and used for every occurrence. (This does not work accross multiple pages containing the same equation.)

# Input

SSST processes markdown files containing posts or pages. SSST expects these files to start with a YAML block containing at least the post/page title (using the `title:` key) and date (using the `date:` key). Values for these keys are  strings (enclosed by single quotes).

The string used as date must either be specified as ISO 8601 dates (like yyyy-mm-dd) or can be specified like this example 'Sun, 19 Apr 2020 08:42:00 +0000'

Any page categories can be specified using the `categories:` key, and any page tags can be specified using the `keywords:` key. The latter two keys expect lists as values, i.e. enumerations separated by comma's enclosed by square brackets. 

Below is an example

```---
   title: 'Maintaining a static self-hosted site'
   date: 'Sun, 19 Apr 2020 08:42:00 +0000'
   categories: [documentation]
   tags: [static, self-hosted, markdown]
   ---
```

# Requirements

- summaries of first few posts on home page
- support tags/keywords (keywords: in YAML), categories (categories: in YAML)
  - below posts
  - pages with links to posts belonging to that tag or category
- date of publication auto-generated
- support LaTeX math (as SVG graphics): latex (standalone package) -> pdf2svg
- support comments (email)
  - comment written in markdown
  - includes name of person submitting comment (derived from from address)
  - includes date of submitting comment
  - show number of comments on summary home page
- support search (startpage site:xot.nl $searchterm)
- statistics

# Input (relative to the INPUT directory)

- input pages stored in folders with the following structure
  ./<optional path>/title.md
- input posts stored in folders with following structure
  ./yyyy/mm/dd/title/index.md
  make sure the date inside the post is correct
- new comment is added in appropriate folder
  ./yyyy/mm/dd/title/comment.x.y.mdc
  where x.y... is the comment numbering scheme: .1 is first main comment, .2 second main comment, ... .x.y is the y-th response to the x-th main comment.
- media stored with post/page in same directory are copied to the output tree 
  (i.e files with extension .jpg, .gif, .pdf and .png)
  keeping their metadata (i.e modification times)
  
# Generated input

Based on the posts in the input tree, the following additional input is generated (all in markdown format, but with extension `.sst` to indicate they
are generated by SSST and should not be treated like orginal posts)

- monthly archives in `./yyyy/mm/index.sst`
- a list of all monthly archives in `./archives.sst`
- category files listing all posts with a certain category in `./category/<categorystring>/index.sst`
- tag files listing all posts with a certain tag in `./tag/<tagstring>/index.sst`

Care is taken to only overwrite these files (and change its modification time) if their content actually changes (to ensure that the corresponding HTML output file is only (re)generated when necessary.

# Output (relative to the OUTPUT directory)

- posts:
  ./yyyy/mm/dd/title/ -> redirects to index.html 
  index.html contains main content and all comments
  all media referenced (and equations generated) stored/copied to ./yyyy/mm/dd/
  - posts point to next/previous post
- pages (essentially undated posts):
  ./<optional path>/title/ -> redirects to index.html 
  index.html contains main content and all comments
  all media referenced (and equations generated) stored/copied to ./yyyy/mm/dd/
- style sheet
- tag pages automatically generated and stored in
  ./tag/<tag>/ -> redirect to index.html in this folder
  list will all posts tagged, in chronological order
- category pages automatically generated and stored in
  ./category/<category>/ -> redirect to index.html in this folder
  list will all chategories tagged, in chronological order
- monthly archives automatically generated and stored in
  ./yyyy/mm/ -> redirects to index.html
  (this could be summaries, as on main home page)
  - archive pages point to next/previous (avialable) month
- home page
  ./ -> redirects to index.html
  contains a summary of the five most recent posts

# Adding post to site (ssst-post.py)

- determine date; derive path
- determine last post; add prev-post link to YAML preamble of post to be added
- add next-post link to YAML preamble of previously last post
- add post.md to the input tree


# Adding comment to site (ssst-comment.py)

- comment received as email
  - subject: contains path to parent post/comment
  - from: contains author
  - date: contains date
  - body: contains comment as markdown
- reply with moderation status
- if accepted, feed email to ssst-comment.py
  - check that parent exists; fail if not
  - get author name from From:
  - get date from Date:
  - sanitise body
  - determine index as child
  - save comment as markdown


# Updating the site (ssst.py)

1. Determine which posts and pages need to be (re)made
   - when index.md changed
   - when comments added 
   => i.e. if output html in output tree is older than any one of these files, or does not exist

Force remake of all pages to (re)create datastructures 
- create prev/next post information from YAML preamble
- archives
- tag/category pages
- home page

2. For every post that needs to be (re)made
    - determine the number of comments, update YAML preamble post.md 
    - convert each comment to html (templates/ssst-comment.html)
    - convert main post to html (templates/ssst-post.html)
      - including comments (use pandoc --include-after / -A)
	  - (remove html versions of comments when done; or rather, do everything safely in a temp directory)
    - convert equations to svg (templates/ssst-eq.tex)
    - update tag pages, when necessary
    - update category pages, when necessary
	- update monthly archives, when neccessary
    - update summary page, when necessary (template ssst-summary.html)
	  - only one main summary page; "older entries" points to archive
	  
3. For every page that needs to be (re)made
    - do essentially the same as above (except ignoring dates)
    - convert page to html (template ssst-page.html)


# Dependencies

This is a program written in Python that depends on

- pandoc
- pdf2svg
- python3
- PyYaml

